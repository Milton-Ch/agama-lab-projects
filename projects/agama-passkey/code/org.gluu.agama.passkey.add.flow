Flow org.gluu.agama.passkey.nickname
     Basepath ""
     Inputs userData
inum = userData.inum
name = userData.name
fidoEnroller = Call org.gluu.agama.passkey.enroll.FidoEnroller#new 
obj = { attestation: "{}", isAttestation: false, showError: false, errorTitle: "", errorMessage: "" }
Repeat 50 times max
     addDeviceForm = RRF "passkey-add.ftlh" obj
     When addDeviceForm.addPasskeyBtn is ""
          detestable = Call fidoEnroller getAttestationMessage inum
          obj.isAttestation = true
          obj.attestation = detestable
          obj.showError = false
     When addDeviceForm.skipped is skipped
          obj.isAttestation = false
          obj.showError = true
          obj.errorTitle = "Passkey registration failed."
          obj.errorMessage = addDeviceForm.errorMessage
     When addDeviceForm.tokenResponse is not ""
          key | E = Call fidoEnroller verifyRegistration inum addDeviceForm.tokenResponse
          When E is null and key is not null
               nicknameTrigger = Trigger org.gluu.agama.passkey.nickname userData
               obj.isAttestation = false
               it_vgnrh = {success:true, data: { userId: inum, property1: "value1"}}
               Finish it_vgnrh
          When E is not null
               obj.isAttestation = false
               obj.showError = true
               obj.errorTitle = "Passkey registration failed."
               obj.errorMessage = E.message
     When addDeviceForm.cancelBtn is ""
          it_ocufd = {success:false, error: "Cancel event"}
          Finish it_ocufd
it_kgcwx = {success:false, error: "Passkey registration attempt exceeded."}
Finish it_kgcwx