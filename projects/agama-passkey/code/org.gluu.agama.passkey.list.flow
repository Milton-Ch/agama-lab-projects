Flow org.gluu.agama.passkey.list
     Basepath ""
     Inputs userData scimSetting
inum = userData.inum
uid = userData.uid
fidoValidator = Call org.gluu.agama.passkey.authn.FidoValidator#new 
scimFido2Helper = Call org.gluu.agama.passkey.ScimFido2Helper#new scimSetting
fidoDevice = Call scimFido2Helper getFidoDeviceByUser inum
obj = { fidoDevice: fidoDevice, assertion: "{}", isAssertion: false, showError: false, errorTitle: "", errorMessage: "" }
Repeat 50 times max
     listForm = RRF "passkey-list.ftlh" obj
     When listForm.addPasskeyBtn is ""
          addTrigger = Trigger org.gluu.agama.passkey.add userData
          obj.showError = false
          obj.isAssertion = false
          When addTrigger.success is true
               obj.fidoDevice = Call scimFido2Helper getFidoDevicesByUser inum
     When listForm.loginWithPasskeyBtn is ""
          destestable = Call fidoValidator assertionRequest uid
          obj.showError = false
          obj.isAssertion = true
          obj.assertion = destestable
     When listForm.skipped is "skipped"
          obj.isAssertion = false
          obj.showError = true
          obj.errorTitle = "Passkey authentication failed."
          obj.errorMessage = listForm.errorMessage
     When listForm.tokenResponse is not "" and listForm.tokenResponse is not null
          verifyResponse | E = Call fidoValidator verify listForm.tokenResponse
          When E is not null
               obj.showError = true
               obj.errorTitle = "Passkey authentication failed."
               obj.errorMessage = E.message
          When E is null
               it_rxvwr = {success:true, data: { userId: inum }}
               Finish it_rxvwr
it_coqgy = {success:false, error: "Passkey registration attempt exceeded"}
Finish it_coqgy